#define DISPLAY_TORSO_ARMOR PATH 
	message ="&"+${PATH}.icon|.png+"="+_ "${PATH}.description|
<small><small>${PATH}.resistance.arcane|% arcane, ${PATH}.resistance.blade|% blade, ${PATH}.resistance.fire|% fire, ${PATH}.resistance.cold|% cold, ${PATH}.resistance.impact|% impact, ${PATH}.resistance.pierce|% pierce
${PATH}.magic_adjust|% magic adj, ${PATH}.evade_adjust| evade adj, -${PATH}.terrain.flat.defense|% def adj</small></small>"#enddef

#define DISPLAY_HEAD_ARMOR PATH 
	message ="&"+${PATH}.icon|.png+"="+_ "${PATH}.description|
<small><small>${PATH}.resistance.arcane|% arcane, ${PATH}.resistance.blade|% blade, ${PATH}.resistance.fire|% fire, ${PATH}.resistance.cold|% cold, ${PATH}.resistance.impact|% impact, ${PATH}.resistance.pierce|% pierce
${PATH}.evade_adjust| evade adj, ${PATH}.ranged_adjust|% ranged adj</small></small>"#enddef

#define DISPLAY_LEGS_ARMOR PATH 
	message="&"+${PATH}.icon|.png+"="+_ "${PATH}.description|
<small><small>${PATH}.resistance.arcane|% arcane, ${PATH}.resistance.blade|% blade, ${PATH}.resistance.fire|% fire, ${PATH}.resistance.cold|% cold, ${PATH}.resistance.impact|% impact, ${PATH}.resistance.pierce|% pierce
${PATH}.magic_adjust|% magic adj, ${PATH}.evade_adjust| evade adj, -${PATH}.terrain.flat.defense|% def adj</small></small>"#enddef

#define DISPLAY_SHIELD PATH 
	message ="&"+${PATH}.icon|.png+"="+_ "${PATH}.description|
<small><small>${PATH}.evade_adjust| evade adjust, ${PATH}.terrain_recoup| terrain adjust, ${PATH}.ranged_adjust|% ranged adj, ${PATH}.magic_adjust|% magic adj
${PATH}.special</small></small>"#enddef

#define DISPLAY_WEAPON PATH 
message="&"+attacks/${PATH}.icon|.png+"="+_ "${PATH}.description|
<small><small>Class: ${PATH}.class_description|${PATH}.evade_description|</small></small>
<small>Base: (${PATH}.damage|-${PATH}.number|), Adjusted: ($display_damage|-$display_number|) ${PATH}.type|
<small>${PATH}.special|</small></small>"#enddef

#define MODRPG_COMMAND_LEVELUP
    [set_menu_item]
        id=b_levelup
		image=commands/button_up.png
        description=_ "Upgrade"
        [filter_location]
            [filter]
                side=$side_number
                canrecruit=yes
            [/filter]
        [/filter_location]

        [command]
            {LEVELUP_MENU}
        [/command]
    [/set_menu_item]
#enddef

#define MODRPG_COMMAND_USE_OTHER_ADJ
    [set_menu_item]
        id=use_other_adj
		image=commands/cast.png
        description=_ "Use/Cast on Unit"
        [filter_location]
            [filter]
                [not]
                    side=$side_number
                    canrecruit=yes
                [/not]
            [/filter]
			[filter_adjacent_location]
				[filter]
					side=$side_number
                    canrecruit=yes
				[/filter]
			[/filter_adjacent_location]
        [/filter_location]
        [command]
            [store_unit]
                variable=current_unit
                [filter]
                    side=$side_number
                    canrecruit=yes
                [/filter]
            [/store_unit]
            {VARIABLE target_x $x1}
            {VARIABLE target_y $y1}
            {VARIABLE acting_x $current_unit.x}
            {VARIABLE acting_y $current_unit.y}

            {CLEAR_VARIABLE use_insert}

            #insert macro to make a bunch of these for all casting skills and atts

            {VARIABLE upgrading 1}
            [while]
                [variable]
                    name=upgrading
                    numerical_equals=1
                [/variable]
                [do]
					{FOREACH current_unit.variables.inventory.spells i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.spells[$i].usable_other_adj
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.spells[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.spells[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.spells[$i].icon|.png+"="+_ "$current_unit.variables.inventory.spells[$i].description
<small>Action uses $current_unit.variables.inventory.spells[$i].action_use, $current_unit.variables.inventory.spells[$i].mana_cost mana</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.spells[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    {FOREACH current_unit.variables.inventory.usables i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.usables[$i].usable_other_adj
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.usables[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.usables[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.usables[$i].icon|.png+"="+_ "$current_unit.variables.inventory.usables[$i].description
<small>Action uses $current_unit.variables.inventory.usables[$i].action_use|</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.usables[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    [if]
                        [variable]
                            name=use_insert.length
                            less_than=1
                        [/variable]
                        [then]
                            [message]
                                speaker=narrator
								side_for=$side_number
                                message=_ "You have nothing to use here."
                                image=wesnoth-icon.png
                            [/message]
                            {VARIABLE upgrading 0}
                        [/then]
                        [else]
							[if]
								[variable]
									name=current_unit.variables.blocked_attacks
									numerical_equals=1
								[/variable]
								[or]
									[variable]
										name=current_unit.attacks_left
										numerical_equals=0
									[/variable]
								[/or]
								[then]
									{VARIABLE actions_temp.attacks ("0 attacks, ")}
								[/then]
								[else]
									{VARIABLE actions_temp.attacks ("1 attack, ")}
								[/else]
							[/if]
							{VARIABLE actions_temp.simple ("$current_unit.variables.simple_action| simple, ")}
							[if]
								[variable]
									name=current_unit.variables.casting_actions
									numerical_equals=1
								[/variable]
								[then]
									{VARIABLE actions_temp.casting ("1 casting time.")}
								[/then]
								[else]
									{VARIABLE actions_temp.casting ("$current_unit.variables.casting_actions| casting time.")}
								[/else]
							[/if]
                            [message]
                                speaker=narrator
                                message= _ "Use which?
Available actions: "+$actions_temp.attacks|+$actions_temp.simple|+$actions_temp.casting|
                                [option]
							        message ="&"+check.png+"="+_ "(End)"="uses left"
							        [command]
										{VARIABLE unit_path current_unit}
							            {CONSTRUCT_UNIT}
							            {VARIABLE_OP upgrading sub 1}
							        [/command]
							    [/option]
                                [insert_tag]
                                    name=option
                                    variable=use_insert
                                [/insert_tag]
                                image=wesnoth-icon.png
                            [/message]
                        [/else]
                    [/if]
                [/do]
            [/while]
        [/command]
    [/set_menu_item]
#enddef

#define MODRPG_COMMAND_USE_OTHER_DIS
    [set_menu_item]
        id=use_other_dis
		image=commands/cast.png
        description=_ "Use/Cast on Unit"
        [filter_location]
            [filter]
                [not]
                    side=$side_number
                    canrecruit=yes
                [/not]
            [/filter]
			[not]
				[filter_adjacent_location]
					[filter]
						side=$side_number
						canrecruit=yes
					[/filter]
				[/filter_adjacent_location]
			[/not]
        [/filter_location]
        [command]
			[store_unit]
                variable=current_unit
                [filter]
                    side=$side_number
                    canrecruit=yes
                [/filter]
            [/store_unit]
            {VARIABLE target_x $x1}
            {VARIABLE target_y $y1}
            {VARIABLE acting_x $current_unit.x}
            {VARIABLE acting_y $current_unit.y}

            {CLEAR_VARIABLE use_insert}

            #insert macro to make a bunch of these for all casting skills and atts

            {VARIABLE upgrading 1}
            [while]
                [variable]
                    name=upgrading
                    numerical_equals=1
                [/variable]
                [do]
					{FOREACH current_unit.variables.inventory.spells i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.spells[$i].usable_other_dis
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.spells[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.spells[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.spells[$i].icon|.png+"="+_ "$current_unit.variables.inventory.spells[$i].description
<small>Action uses $current_unit.variables.inventory.spells[$i].action_use, $current_unit.variables.inventory.spells[$i].mana_cost mana</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.spells[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    {FOREACH current_unit.variables.inventory.usables i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.usables[$i].usable_other_dis
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.usables[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.usables[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.usables[$i].icon|.png+"="+_ "$current_unit.variables.inventory.usables[$i].description
<small>Action uses $current_unit.variables.inventory.usables[$i].action_use|</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.usables[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    [if]
                        [variable]
                            name=use_insert.length
                            less_than=1
                        [/variable]
                        [then]
                            [message]
                                speaker=narrator
								side_for=$side_number
                                message=_ "You have nothing to use here."
                                image=wesnoth-icon.png
                            [/message]
                            {VARIABLE upgrading 0}
                        [/then]
                        [else]
							[if]
								[variable]
									name=current_unit.variables.blocked_attacks
									numerical_equals=1
								[/variable]
								[or]
									[variable]
										name=current_unit.attacks_left
										numerical_equals=0
									[/variable]
								[/or]
								[then]
									{VARIABLE actions_temp.attacks ("0 attacks, ")}
								[/then]
								[else]
									{VARIABLE actions_temp.attacks ("1 attack, ")}
								[/else]
							[/if]
							{VARIABLE actions_temp.simple ("$current_unit.variables.simple_action| simple, ")}
							[if]
								[variable]
									name=current_unit.variables.casting_actions
									numerical_equals=1
								[/variable]
								[then]
									{VARIABLE actions_temp.casting ("1 casting time.")}
								[/then]
								[else]
									{VARIABLE actions_temp.casting ("$current_unit.variables.casting_actions| casting time.")}
								[/else]
							[/if]
                            [message]
                                speaker=narrator
                                message= _ "Use which?
Available actions: "+$actions_temp.attacks|+$actions_temp.simple|+$actions_temp.casting|
                                [option]
							        message ="&"+check.png+"="+_ "(End)"="uses left"
							        [command]
										{VARIABLE unit_path current_unit}
							            {CONSTRUCT_UNIT}
							            {VARIABLE_OP upgrading sub 1}
							        [/command]
							    [/option]
                                [insert_tag]
                                    name=option
                                    variable=use_insert
                                [/insert_tag]
                                image=wesnoth-icon.png
                            [/message]
                        [/else]
                    [/if]
                [/do]
            [/while]
        [/command]
    [/set_menu_item]
#enddef

#define MODRPG_COMMAND_USE_ADJ
    [set_menu_item]
        id=use_adj
		image=commands/cast.png
        description=_ "Use/Cast"
        [filter_location]
            [not]
                [filter]
                [/filter]
            [/not]
            [filter_adjacent_location]
				[filter]
					side=$side_number
					canrecruit=yes
				[/filter]
			[/filter_adjacent_location]
        [/filter_location]
        [command]
            [store_unit]
                variable=current_unit
                [filter]
                    side=$side_number
                    canrecruit=yes
                [/filter]
            [/store_unit]
            {VARIABLE target_x $x1}
            {VARIABLE target_y $y1}
            {VARIABLE acting_x $current_unit.x}
            {VARIABLE acting_y $current_unit.y}

            {CLEAR_VARIABLE use_insert}

            #insert macro to make a bunch of these for all casting skills and atts

            {VARIABLE upgrading 1}
            [while]
                [variable]
                    name=upgrading
                    numerical_equals=1
                [/variable]
                [do]
					{FOREACH current_unit.variables.inventory.spells i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.spells[$i].usable_adj
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.spells[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.spells[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.spells[$i].icon|.png+"="+_ "$current_unit.variables.inventory.spells[$i].description
<small>Action uses $current_unit.variables.inventory.spells[$i].action_use, $current_unit.variables.inventory.spells[$i].mana_cost mana</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.spells[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    {FOREACH current_unit.variables.inventory.usables i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.usables[$i].usable_adj
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.usables[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.usables[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.usables[$i].icon|.png+"="+_ "$current_unit.variables.inventory.usables[$i].description
<small>Action uses $current_unit.variables.inventory.usables[$i].action_use|</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.usables[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    [if]
                        [variable]
                            name=use_insert.length
                            less_than=1
                        [/variable]
                        [then]
                            [message]
                                speaker=narrator
								side_for=$side_number
                                message=_ "You have nothing to use here."
                                image=wesnoth-icon.png
                            [/message]
                            {VARIABLE upgrading 0}
                        [/then]
                        [else]
                            [if]
								[variable]
									name=current_unit.variables.blocked_attacks
									numerical_equals=1
								[/variable]
								[or]
									[variable]
										name=current_unit.attacks_left
										numerical_equals=0
									[/variable]
								[/or]
								[then]
									{VARIABLE actions_temp.attacks ("0 attacks, ")}
								[/then]
								[else]
									{VARIABLE actions_temp.attacks ("1 attack, ")}
								[/else]
							[/if]
							{VARIABLE actions_temp.simple ("$current_unit.variables.simple_action| simple, ")}
							[if]
								[variable]
									name=current_unit.variables.casting_actions
									numerical_equals=1
								[/variable]
								[then]
									{VARIABLE actions_temp.casting ("1 casting time.")}
								[/then]
								[else]
									{VARIABLE actions_temp.casting ("$current_unit.variables.casting_actions| casting time.")}
								[/else]
							[/if]
                            [message]
                                speaker=narrator
                                message= _ "Use which?
Available actions: "+$actions_temp.attacks|+$actions_temp.simple|+$actions_temp.casting|
                                [option]
							        message ="&"+check.png+"="+_ "(End)"="uses left"
							        [command]
										{VARIABLE unit_path current_unit}
							            {CONSTRUCT_UNIT}
							            {VARIABLE_OP upgrading sub 1}
							        [/command]
							    [/option]
                                [insert_tag]
                                    name=option
                                    variable=use_insert
                                [/insert_tag]
                                image=wesnoth-icon.png
                            [/message]
                        [/else]
                    [/if]
                [/do]
            [/while]
        [/command]
    [/set_menu_item]
#enddef

#define MODRPG_COMMAND_USE_DIS
    [set_menu_item]
        id=use_dis
		image=commands/cast.png
        description=_ "Use/Cast"
        [filter_location]
            [not]
                [filter]
                [/filter]
            [/not]
            [not]
                [filter_adjacent_location]
					[filter]
						side=$side_number
						canrecruit=yes
					[/filter]
				[/filter_adjacent_location]
            [/not]
        [/filter_location]

        [command]
            [store_unit]
                variable=current_unit
                [filter]
                    side=$side_number
                    canrecruit=yes
                [/filter]
            [/store_unit]
            {VARIABLE target_x $x1}
            {VARIABLE target_y $y1}
            {VARIABLE acting_x $current_unit.x}
            {VARIABLE acting_y $current_unit.y}

            {CLEAR_VARIABLE use_insert}

            #insert macro to make a bunch of these for all casting skills and atts

            {VARIABLE upgrading 1}
            [while]
                [variable]
                    name=upgrading
                    numerical_equals=1
                [/variable]
                [do]
					{FOREACH current_unit.variables.inventory.spells i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.spells[$i].usable_dis
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.spells[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.spells[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.spells[$i].icon|.png+"="+_ "$current_unit.variables.inventory.spells[$i].description
<small>Action uses $current_unit.variables.inventory.spells[$i].action_use, $current_unit.variables.inventory.spells[$i].mana_cost mana</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.spells[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    {FOREACH current_unit.variables.inventory.usables i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.usables[$i].usable_dis
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.usables[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.usables[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.usables[$i].icon|.png+"="+_ "$current_unit.variables.inventory.usables[$i].description
<small>Action uses $current_unit.variables.inventory.usables[$i].action_use|</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.usables[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    [if]
                        [variable]
                            name=use_insert.length
                            less_than=1
                        [/variable]
                        [then]
                            [message]
                                speaker=narrator
								side_for=$side_number
                                message=_ "You have nothing to use here."
                                image=wesnoth-icon.png
                            [/message]
                            {VARIABLE upgrading 0}
                        [/then]
                        [else]
                            [if]
								[variable]
									name=current_unit.variables.blocked_attacks
									numerical_equals=1
								[/variable]
								[or]
									[variable]
										name=current_unit.attacks_left
										numerical_equals=0
									[/variable]
								[/or]
								[then]
									{VARIABLE actions_temp.attacks ("0 attacks, ")}
								[/then]
								[else]
									{VARIABLE actions_temp.attacks ("1 attack, ")}
								[/else]
							[/if]
							{VARIABLE actions_temp.simple ("$current_unit.variables.simple_action| simple, ")}
							[if]
								[variable]
									name=current_unit.variables.casting_actions
									numerical_equals=1
								[/variable]
								[then]
									{VARIABLE actions_temp.casting ("1 casting time.")}
								[/then]
								[else]
									{VARIABLE actions_temp.casting ("$current_unit.variables.casting_actions| casting time.")}
								[/else]
							[/if]
                            [message]
                                speaker=narrator
                                message= _ "Use which?
Available actions: "+$actions_temp.attacks|+$actions_temp.simple|+$actions_temp.casting|
                                [option]
							        message ="&"+check.png+"="+_ "(End)"="uses left"
							        [command]
										{VARIABLE unit_path current_unit}
							            {CONSTRUCT_UNIT}
							            {VARIABLE_OP upgrading sub 1}
							        [/command]
							    [/option]
                                [insert_tag]
                                    name=option
                                    variable=use_insert
                                [/insert_tag]
                                image=wesnoth-icon.png
                            [/message]
                        [/else]
                    [/if]
                [/do]
            [/while]
        [/command]
    [/set_menu_item]
#enddef

#define MODRPG_COMMAND_USE_SELF
    [set_menu_item]
        id=use_self
		image=commands/cast.png
        description=_ "Use/Cast on Self"
        [filter_location]
            [filter]
                side=$side_number
                canrecruit=yes
            [/filter]
        [/filter_location]
        [command]
            [store_unit]
                variable=current_unit
                [filter]
                    side=$side_number
                    canrecruit=yes
                [/filter]
            [/store_unit]
            {VARIABLE target_x $x1}
            {VARIABLE target_y $y1}
            {VARIABLE acting_x $current_unit.x}
            {VARIABLE acting_y $current_unit.y}

            {CLEAR_VARIABLE use_insert}

            #insert macro to make a bunch of these for all casting skills and atts

            {VARIABLE upgrading 1}
            [while]
                [variable]
                    name=upgrading
                    numerical_equals=1
                [/variable]
                [do]
					{FOREACH current_unit.variables.inventory.spells i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.spells[$i].usable_self
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.spells[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.spells[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.spells[$i].icon|.png+"="+_ "$current_unit.variables.inventory.spells[$i].description
<small>Action uses $current_unit.variables.inventory.spells[$i].action_use, $current_unit.variables.inventory.spells[$i].mana_cost mana</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.spells[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    {FOREACH current_unit.variables.inventory.usables i}
                        [if]
                            [variable]
                                name=current_unit.variables.inventory.usables[$i].usable_self
                                numerical_not_equals=1
                            [/variable]
                            [then]
                            [/then]
                            [else]
                                [if]
                                    [variable]
                                        name=current_unit.variables.inventory.usables[$i].infinite
                                        numerical_equals=1
                                    [/variable]
                                    [then]
                                        {VARIABLE uses_left "-"}
                                    [/then]
									[else]
										{VARIABLE uses_left $current_unit.variables.inventory.usables[$i].uses}
									[/else]
                                [/if]
								#need uses left gauge
                                [set_variables]
                                    name=use_insert
                                    mode=append
                                    [value]
                                        message="&"+$current_unit.variables.inventory.usables[$i].icon|.png+"="+_ "$current_unit.variables.inventory.usables[$i].description
<small>Action uses $current_unit.variables.inventory.usables[$i].action_use|</small>"="$uses_left"
                                        [command]
											{VARIABLE item_id $i}
											[fire_event]
												name=$current_unit.variables.inventory.usables[$i].command
											[/fire_event]
                                            {VARIABLE upgrading 0}
                                        [/command]
                                    [/value]
                                [/set_variables]
                            [/else]
                        [/if]
                    {NEXT i}
                    [if]
                        [variable]
                            name=use_insert.length
                            less_than=1
                        [/variable]
                        [then]
                            [message]
                                speaker=narrator
								side_for=$side_number
                                message=_ "You have nothing to use here."
                                image=wesnoth-icon.png
                            [/message]
                            {VARIABLE upgrading 0}
                        [/then]
                        [else]
							[if]
								[variable]
									name=current_unit.variables.blocked_attacks
									numerical_equals=1
								[/variable]
								[or]
									[variable]
										name=current_unit.attacks_left
										numerical_equals=0
									[/variable]
								[/or]
								[then]
									{VARIABLE actions_temp.attacks ("0 attacks, ")}
								[/then]
								[else]
									{VARIABLE actions_temp.attacks ("1 attack, ")}
								[/else]
							[/if]
							{VARIABLE actions_temp.simple ("$current_unit.variables.simple_action| simple, ")}
							[if]
								[variable]
									name=current_unit.variables.casting_actions
									numerical_equals=1
								[/variable]
								[then]
									{VARIABLE actions_temp.casting ("1 casting time.")}
								[/then]
								[else]
									{VARIABLE actions_temp.casting ("$current_unit.variables.casting_actions| casting time.")}
								[/else]
							[/if]
                            [message]
                                speaker=narrator
                                message= _ "Use which? 
<small>Note: Right-click on other units and hexes to use or cast on them.</small>
Available actions: "+$actions_temp.attacks|+$actions_temp.simple|+$actions_temp.casting|
                                [option]
							        message ="&"+check.png+"="+_ "(End)"="uses left"
							        [command]
										{VARIABLE unit_path current_unit}
							            {CONSTRUCT_UNIT}
							            {VARIABLE_OP upgrading sub 1}
							        [/command]
							    [/option]
                                [insert_tag]
                                    name=option
                                    variable=use_insert
                                [/insert_tag]
                                image=wesnoth-icon.png
                            [/message]
                        [/else]
                    [/if]
                [/do]
            [/while]
        [/command]
    [/set_menu_item]
#enddef

#define MODRPG_COMMAND_HENCH_RELEASE
    [set_menu_item]
        id=y_release_hench
		image=commands/button_x.png
        description=_ "Release Henchman"
        [filter_location]
            [filter]
                side=$side_number
                [not]
                    canrecruit=yes
                [/not]
				[filter_wml]
					[variables]
						[not]
							is_summon=1
						[/not]
					[/variables]
				[/filter_wml]
            [/filter]
        [/filter_location]
        [command]
            [message]
                message=_ "Do you really want to release this unit?"
				x,y=$x1,$y1
                [option]
                    message=_ "No."
                    [command]
                    [/command]
                [/option]
                [option]
                    message=_ "Yes."
                    [command]
                        [message]
							side=$side_number
							canrecruit=yes
							side_for=$side_number
                            message=_ "You are dismissed."
                        [/message]
                        [kill]
                            x,y=$x1,$y1
                            animate=yes
                        [/kill]
                    [/command]
                [/option]
            [/message]
        [/command]
    [/set_menu_item]
#enddef